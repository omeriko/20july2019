/*!
 * Client
 * Copyright (c) 2011 Delta Integrity Systems
 */
(function () {
    var p = {
        init: function () {
            this.browser = this.browser();
            this.screen = this._screen();
            this.os = this.os();
        },
        timeZone: function () {
            var f = function (a) {
                var b = parseInt(a);
                a -= parseInt(a);
                a *= 60;
                var c = parseInt(a);
                a -= parseInt(a);
                a *= 60;
                var d = parseInt(a);
                var e = b;
                if (b == 0) {
                    e = "00";
                } else if (b > 0) {
                    e = (b < 10) ? "+0" + b : "+" + b;
                } else {
                    e = (b > -10) ? "-0" + Math.abs(b) : b;
                }
                c = (c < 10) ? "0" + c : c;
                return e + ":" + c;
            };
            var g = new Date();
            var h = new Date(g.getFullYear(), 0, 1, 0, 0, 0, 0);
            var i = new Date(g.getFullYear(), 6, 1, 0, 0, 0, 0);
            var j = h.toGMTString();
            var k = new Date(j.substring(0, j.lastIndexOf(" ") - 1));
            j = i.toGMTString();
            var l = new Date(j.substring(0, j.lastIndexOf(" ") - 1));
            var m = (h - k) / (1000 * 60 * 60);
            var n = (i - l) / (1000 * 60 * 60);
            if (m == n) {} else {
                var o = m - n;
                if (o >= 0) 
                	m = n;
            }
            return f(m);
        },
        os: function () {
            var a = "Unknown OS";
            var b = window.navigator.platform;
            var c = navigator.userAgent;
            if (c.indexOf("Win") != -1) {
                if ((c.indexOf("Windows NT 5.1") != -1) || (c.indexOf("Windows XP") != -1)) a = "Win XP";
                else if ((c.indexOf("Windows NT 7.0") != -1) || (c.indexOf("Windows NT 6.1") != -1)) a = "Win 7";
                else if ((c.indexOf("Windows NT 6.0") != -1)) a = "Win Vista/Server 08";
                else if (c.indexOf("Windows ME") != -1) a = "Win ME";
                else if ((c.indexOf("Windows NT 4.0") != -1) || (c.indexOf("WinNT4.0") != -1) || (c.indexOf("WinNT") != -1)) a = "Win NT";
                else if ((c.indexOf("Windows NT 5.2") != -1)) a = "Win Server 03";
                else if ((c.indexOf("Windows NT 5.0") != -1) || (c.indexOf("Windows 2000") != -1)) a = "Win 2000";
                else if ((c.indexOf("Windows 98") != -1) || (c.indexOf("Win98") != -1)) a = "Win 98";
                else if ((c.indexOf("Windows 95") != -1) || (c.indexOf("Win95") != -1) || (c.indexOf("Windows_95") != -1)) a = "Win 95";
                else if ((c.indexOf("Win16") != -1)) a = "Win 3.1";
                else a = "Win Ver. Unknown";
                if ((c.indexOf("WOW64") != -1) || (c.indexOf("x64") != -1) || (c.indexOf("Win64") != -1) || (c.indexOf("IA64") != -1)) a = a + " (x64)";
                else a = a + " (x32)"
            } else if (c.indexOf("Mac") != -1) a = "MacOS";
            else if (c.indexOf("X11") != -1) a = "UNIX";
            else if (c.indexOf("Linux") != -1) a = "Linux";
            return {
                name: a,
                version: null,
                platform: b,
                cpuClass: window.navigator.cpuClass,
                oscpu: window.navigator.oscpu,
                isOnline: window.navigator.onLine,
                systemLanguage: ((window.navigator.systemLanguage != undefined) ? window.navigator.systemLanguage : window.navigator.language),
                timeZone: this.timeZone()
            }
        },
        _screen: function () {
            return {
                width: screen.width,
                height: screen.height,
                color: ((screen.pixelDepth != undefined) ? screen.pixelDepth : screen.colorDepth)
            }
        },
        browser: function () {
            var g = function () {
                var a = -1;
                var b = navigator.userAgent;
                var c = new RegExp("Trident\/([0-9]{1,}[\.0-9]{0,})");
                if (c.exec(b) != null) {
                    a = parseFloat(RegExp.$1);
                }
                return (a == 4);
            };
            var h = function () {
                var a = "";
                var b = false;
                if (/MSIE (\d+\.\d+);/.test(navigator.userAgent)) {
                    b = true;
                    var c = new Number(RegExp.$1);
                    if (c >= 8) 
                    	a = "IE8 or +";
                    else if (c >= 7) {
                        if (g()) {
                            a = "IE8+ (IE7 run mode)";
                        } else {
                            a = "IE7.x";
                        }
                    } else if (c >= 6) 
                    	a = "IE6.x";
                    else if (c >= 5) 
                    	a = "IE5.x";
                    else 
                    	a = "IE (Ver?)";
                } else if (/Opera[\/\s](\d+\.\d+)/.test(navigator.userAgent)) {
                    var d = new Number(RegExp.$1) 
                    if (d >= 10) 
                    	a = "Opera 10.x or +";
                    else if (d >= 9) 
                    	a = "Opera 9.x";
                    else if (d >= 8) 
                    	a = "Opera 8.x";
                    else if (d >= 7) 
                    	a = "Opera 7.x";
                    else 
                    	a = "Opera (Ver?)";
                } else if (/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)) {
                    var e = new Number(RegExp.$1);
                    if (e >= 3) 
                    	a = "Firefox 3.x or +";
                    else if (e >= 2) 
                    	a = "Firefox 2.x";
                    else if (e >= 1) 
                    	a = "Firefox 1.x";
                    else 
                    	a = "Firefox (Ver?)";
                } else if (/Chrome[\/\s](\d+\.\d+)/.test(navigator.userAgent)) {
                    var f = new Number(RegExp.$1);
                    if (f >= 9) 
                    	a = "Chrome 9.x or +";
                    else if (f >= 3) 
                    	a = "Chrome 3.x";
                    else if (f >= 2) 
                    	a = "Chrome 2.x";
                    else if (f >= 1) 
                    	a = "Chrome 1.x";
                    else 
                    	a = "Chrome (Ver?)";
                } else if (/Safari[\/\s](\d+\.\d+)/.test(navigator.userAgent)) {
                    var d = new Number(RegExp.$1);
                    if (d >= 5) 
                    	a = "Safari 5x or +";
                    else if (d >= 4) 
                    	a = "Safari 4.x";
                    else if (d >= 3) 
                    	a = "Safari 3.x";
                    else if (d >= 2) 
                    	a = "Safari 2.x";
                    else 
                    	a = "Safari (Ver?)";
                } else {
                    a = "Browser?/Ver?";
                }
                return a;
            };
            var i = function () {
                var a = false;
                if (navigator.plugins && navigator.plugins.length) {
                    for (x = 0; x < navigator.plugins.length; x++) {
                        if (navigator.plugins[x].name.indexOf('Java(TM)') != -1) {
                            a = true;
                            break;
                        }
                    }
                }
                if (navigator.javaEnabled()) {
                    a = true;
                }
                return {
                    isInstalled: a
                }
            };
            var j = function () {
                isInstalled = true;
                flash_versions = 10;
                h = '0.0';
                if (navigator.plugins && navigator.plugins.length) {
                    for (x = 0; x < navigator.plugins.length; x++) {
                        if (navigator.plugins[x].name.indexOf('Shockwave Flash') != -1) {
                            h = navigator.plugins[x].description.split('Shockwave Flash ')[1];
                            isInstalled = true;
                            break;
                        }
                    }
                } else if (window.ActiveXObject) {
                    for (x = 2; x <= flash_versions; x++) {
                        try {
                            oFlash = eval("new ActiveXObject('ShockwaveFlash.ShockwaveFlash." + x + "');");
                            if (oFlash) {
                                isInstalled = true;
                                h = x + '.0';
                            }
                        } catch (e) {}
                    }
                }
                return {
                    isInstalled: isInstalled,
                    version: h
                }
            };
            return {
                appName: window.navigator.appName,
                vendor: window.navigator.vendor,
                appCodeName: window.navigator.appCodeName,
                appVersion: window.navigator.appVersion,
                product: window.navigator.product,
                buildNumber: ((window.opera) ? window.opera.buildNumber() : window.navigator.productSub),
                userAgent: window.navigator.userAgent,
                cookieEnabled: window.navigator.cookieEnabled,
                version: h(),
                java: i(),
                flash: j()
            }
        }
    };
    p.init();
    window.$.client = {
        os: p.os,
        browser: p.browser,
        screen: p.screen
    }
})();